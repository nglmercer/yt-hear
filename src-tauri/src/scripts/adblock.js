(() => {
    let lastUrl ="";
    const e = { CACHE_TTL: 864e5, MAX_CACHE_SIZE: 1e3, CACHE_CLEANUP_INTERVAL: 6e4, DYNAMIC_SCAN_INTERVAL: 2e3, DYNAMIC_SCAN_DEBOUNCE: 500, INIT_MAX_ATTEMPTS: 100, INIT_RETRY_DELAY: 50, ENGINE_MAX_ATTEMPTS: 50, ENGINE_RETRY_DELAY: 200, YOUTUBE_CHECK_INTERVAL: 500, YOUTUBE_SKIP_DELAY: 100 }, t = [], n = { domains: ["doubleclick.net", "googleadservices.com", "google-analytics.com", "googletagmanager.com", "googletagservices.com"], paths: ["/pagead/", "/pcs/click"], params: ["ad_type", "adurl"] }, o = window.fetch, i = window.XMLHttpRequest; let a = null, s = !1, c = null, r = null; const l = new Map, d = new Set, u = new Set, m = new Map; let h = null, g = null, f = null, p = null; const w = { networkBlocked: 0, cosmeticBlocked: 0, youtubeAdsSkipped: 0, youtubeTrackingBlocked: 0 }, y = e => t.some((t => e.includes(t))), b = e => !!(e && e.startsWith("tauri://") || e.startsWith("ipc://") || e.includes("__TAURI_IPC__")); function v(e) { return !e || e.startsWith("data:") || e.startsWith("blob:") || e.startsWith("about:") || b(e) || y(e) } function x(e) { if (!e) return !1; try { const o = new URL(e), i = o.hostname, a = o.pathname; for (const e of n.domains) if (i.includes(e)) return w.youtubeTrackingBlocked++, !0; return a.includes("/pagead/") || a.includes("/pcs/click") ? (w.youtubeTrackingBlocked++, !0) : !1 } catch (e) { return !1 } } window.addEventListener("beforeunload", (() => { h && clearInterval(h), g && clearInterval(g), f && clearTimeout(f), p && clearInterval(p), l.clear(), d.clear(), u.clear(), m.clear() })); async function _() { let t = 0; for (; !window.__TAURI__?.core?.invoke && t < e.INIT_MAX_ATTEMPTS; await new Promise((e => setTimeout(e, e.INIT_RETRY_DELAY))), t++); if (!window.__TAURI__?.core?.invoke) return !1; a = window.__TAURI__.core.invoke; let n = 0; for (; !s && n < e.ENGINE_MAX_ATTEMPTS;)try { if (s = await a("is_adblock_ready")) break; await new Promise((t => setTimeout(t, e.ENGINE_RETRY_DELAY))), n++ } catch (e) { await new Promise((t => setTimeout(t, e.ENGINE_RETRY_DELAY))), n++ } if (!s) return !1; await T(), A(), window.location.hostname.includes("youtube.com") && L(), window.__ADBLOCK_INITIALIZED__ = !0 } async function T() { if (!s || !a) return; const e = await a("get_cosmetic_resources", { url: window.location.href }); r = e, c || (c = document.createElement("style"), c.id = "__adblock_cosmetic_filters__", (document.head || document.documentElement).appendChild(c)), e.hide_selectors?.length > 0 && (c.textContent = e.hide_selectors.map((e => `${e} { display: none !important; visibility: hidden !important; }`)).join("\n"), w.cosmeticBlocked += e.hide_selectors.length), e.procedural_actions?.length > 0 && S(e.procedural_actions), e.injected_script && (() => { try { const e = document.createElement("script"); e.textContent = r.injected_script, (document.head || document.documentElement).appendChild(e), e.remove() } catch (e) { } })() } function S(e) { let t = 0; e.forEach((e => { try { const n = JSON.parse(e); if (1 === n.selector?.length && n.selector[0].CssSelector && n.action?.Style) { const e = n.selector[0].CssSelector, o = n.action.Style; c.textContent += `\n${e} { ${o} }`, t++; return } M(n) && t++ } catch (e) { } })), t > 0 && 0 } function M(e) { try { if (e.action?.RemoveAttr) { const t = e.action.RemoveAttr, n = e.selector?.[0]?.CssSelector; if (n) return document.querySelectorAll(n).forEach((e => e.removeAttribute(t))), !0 } if (e.action?.RemoveClass) { const t = e.action.RemoveClass, n = e.selector?.[0]?.CssSelector; if (n) return document.querySelectorAll(n).forEach((e => e.classList.remove(t))), !0 } } catch (e) { } return !1 } async function C() { if (!s || !a || !r || r.generichide) return; const e = []; document.querySelectorAll("[class]").forEach((t => { t.classList.forEach((n => { n && n.length > 2 && !d.has(n) && (d.add(n), e.push(n)) })) })); const t = []; document.querySelectorAll("[id]").forEach((e => { e.id && e.id.length > 2 && !u.has(e.id) && (u.add(e.id), t.push(e.id)) })); if (0 === e.length && 0 === t.length) return; try { const n = await a("get_hidden_class_id_selectors", { classes: e, ids: t, exceptions: r.exceptions || [] }); n?.length > 0 && (c.textContent += "\n" + n.map((e => `${e} { display: none !important; visibility: hidden !important; }`)).join("\n"), w.cosmeticBlocked += n.length) } catch (e) { } } async function k(t, n) { if (!s || v(t)) return !1; if (x(t)) return !0; const o = `${t}|${n}`, i = (Date.now(), l.get(o)); if (i && Date.now() - i.time < e.CACHE_TTL) return i.blocked; if (m.has(o)) return m.get(o); const c = (async () => { try { const i = await a("is_url_blocked", { url: t, sourceUrl: window.location.href, requestType: n }); return l.set(o, { blocked: i, time: Date.now() }), l.size > e.MAX_CACHE_SIZE && (() => { const t = Date.now(); for (const [n, o] of l.entries()) t - o.time > e.CACHE_TTL && l.delete(n) })(), i && w.networkBlocked++, i } catch (e) { return !1 } finally { m.delete(o) } })(); return m.set(o, c), c } function A() { h = setInterval((() => { const e = Date.now(); for (const [t, n] of l.entries()) e - n.time > 6e5 && l.delete(t); l.size > e.MAX_CACHE_SIZE && (() => { const e = Array.from(l.entries()); e.sort(((e, t) => e[1].time - t[1].time)); for (let t = 0; t < Math.min(100, e.length); t++)l.delete(e[t][0]) })() }), e.CACHE_CLEANUP_INTERVAL), g = setInterval((() => { s && C() }), e.DYNAMIC_SCAN_INTERVAL), setInterval((() => { 0 }), 3e4) } function L() {
        const t = document.createElement("style"); t.textContent = `
            .video-ads.ytp-ad-module,.ytp-ad-player-overlay,.ytp-ad-player-overlay-layout,.ytp-ad-text-overlay,.ytp-ad-image-overlay{opacity:0!important;pointer-events:none!important;height:0!important;overflow:hidden!important}
            ytd-display-ad-renderer,ytd-banner-promo-renderer,ytd-companion-slot-renderer,#masthead-ad,.ytd-promoted-sparkles-web-renderer{display:none!important}
            .html5-video-container{opacity:1!important}`, (document.head || document.documentElement).appendChild(t); const n = () => { try { const e = document.querySelector(".ytp-ad-skip-button, .ytp-ad-skip-button-modern, .ytp-skip-ad-button"); if (e && null !== e.offsetParent) return e.click(), void w.youtubeAdsSkipped++; const t = document.querySelector("video.html5-main-video"); if (t) { const e = document.querySelector(".ad-showing, .ytp-ad-player-overlay"); e ? (t.playbackRate = 16, t.duration && isFinite(t.duration) && t.duration > 0 && (t.currentTime = t.duration - .1, w.youtubeAdsSkipped++)) : 1 !== t.playbackRate && (t.playbackRate = 1) } document.querySelectorAll(".ytp-ad-overlay-close-button, button[aria-label*=Close ad]").forEach((e => { null !== e.offsetParent && e.click() })) } catch (e) { } }; p = setInterval(n, e.YOUTUBE_CHECK_INTERVAL); const o = new MutationObserver((() => { document.querySelector(".ad-showing, .ytp-ad-player-overlay") && n() })); let i = 0; const a = setInterval((() => { const e = document.querySelector(".html5-video-player"); e && (o.observe(e, { attributes: !0, attributeFilter: ["class"], childList: !0, subtree: !0 }), clearInterval(a)), ++i > 10 && clearInterval(a) }), 1e3)
    } function E() { f && clearTimeout(f), f = setTimeout(C, e.DYNAMIC_SCAN_DEBOUNCE) } window.fetch = async function (...t) { const n = t[0], s = "string" == typeof n ? n : n?.url || ""; if (v(s)) return o.apply(this, t); const a = t[1] || {}; return "OPTIONS" === a.method || "HEAD" === a.method ? o.apply(this, t) : await k(s, "fetch") ? new Response("", { status: 200, statusText: "OK", headers: new Headers }) : o.apply(this, t) }, window.XMLHttpRequest = function () { const e = new i, t = e.open, n = e.send, a = {}, s = ""; let c = ""; return e.open = function (e, o, ...i) { return c = e, a.open = [e, o, i], t.call(this, e, o, ...i) }, e.send = async function (...t) { const o = a.open?.[1] || s; return o && v(o) || "OPTIONS" === c || "HEAD" === c ? n.call(this, t) : await k(o, "xhr") ? (Object.defineProperties(e, { status: { value: 200, configurable: !0 }, statusText: { value: "OK", configurable: !0 }, readyState: { value: 4, configurable: !0 }, responseText: { value: "", configurable: !0 } }), setTimeout((() => { e.onreadystatechange && e.onreadystatechange(new Event("readystatechange")), e.onload && e.onload(new Event("load")) }), 0), void 0) : n.call(this, t) }, e }; const O = new MutationObserver((t => { if (!s) return; let n = !1; const o = []; for (const e of t) { if ("attributes" === e.type) { n = !0; continue } for (const t of e.addedNodes) { if (1 !== t.nodeType) continue; t.classList?.length > 0 || t.id ? n = !0 : ["script", "iframe", "img", "link"].includes(t.tagName?.toLowerCase()) && o.push(t) } } o.length > 0 && P(o), n && E() })); async function P(e) { for (const t of e) { const e = t.tagName?.toLowerCase(), n = t.src || t.href || t.data || t.getAttribute("src") || t.getAttribute("href") || t.getAttribute("data"); n && !v(n) && (await k(n, e)) && t.parentNode && t.remove() } } O.observe(document.documentElement, { childList: !0, subtree: !0, attributes: !0, attributeFilter: ["class", "id", "src", "href", "data"] }), window.addEventListener("load", (() => { T().then(C) })), new MutationObserver((() => { const e = location.href; e !== lastUrl && (lastUrl = e, d.clear(), u.clear(), window.location.hostname.includes("youtube.com") && !p && L(), T().then(C)) })).observe(document, { subtree: !0, childList: !0 }); let R = location.href; _.then((e => { e && C() }))
})();